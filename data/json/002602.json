{"code": 0, "data": {"allow_search": true, "attention": false, "author_title": null, "blocked": false, "blocked_count": null, "can_del": false, "comments": null, "create_time": 1639636020, "cw": "报时bot代码", "hot_score": null, "is_blocked": false, "is_reported": null, "is_tmp": false, "last_comment_time": 1639796376, "likenum": 34, "n_attentions": 34, "n_comments": 13, "pid": 2602, "poll": null, "reply": 13, "text": "就是每到整点发一个post请求。\n吟诗用的是[一言](https://hitokoto.cn/)的接口。\n如有需要可随意取用。\n\n```python\nimport requests\nimport time\nfrom datetime import datetime\nimport sys\n\nclass Puppet:\n    def __init__(self, token):\n        self.token = token\n        self.api = r'https://hole.thu.monster/_api/v1/'\n        self.ua = r'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.93 Safari/537.36'\n\n    def post(self, content, *, cw='', allow_search=False):\n        payload = {\n            'cw': cw,\n            'text': content,\n            'allow_search': '1' if allow_search else '',\n            'type': 'text',\n        }\n        headers = {\n            'user-agent': self.ua,\n            'user-token': self.token,\n        }\n        url = self.api + 'dopost'\n        r = requests.post(url, data=payload, headers=headers)\n        print(r)\n\n\ndef getClock(now):\n    sentence_api = 'https://international.v1.hitokoto.cn/'\n    params = [\n        ['c', 'd'],\n        ['c', 'i'],\n        ['c', 'k'],\n    ] # 见https://developer.hitokoto.cn/sentence/#%E8%BF%94%E5%9B%9E%E6%A0%BC%E5%BC%8F\n    try:\n        r = requests.get(sentence_api, params=params)\n        data = r.json()\n    except Exception as e:\n        print(e)\n        data = None\n    if data:\n        hitokoto = data['hitokoto']\n        place = data['from']\n        author = data['from_who']\n        sentence = f'{hitokoto}\\n        ——{author}《{place}》'\n    else:\n        sentence = ''\n\n    now_str = now.strftime(r'%Y-%m-%d %H:%M')\n    content = f'#报时 **北京时间 {now_str}**\\n{sentence}'\n    return content\n\n\ndelay = 10\npuppet = Puppet(sys.argv[1])\n\nwhile True:\n    now = datetime.now()\n    # print(getClock(now))\n    print(now)\n    if now.minute == 0 or now.minute == 30:\n        content = getClock(now)\n        puppet.post(content, allow_search=True)\n        delay = 1800 - now.second\n    time.sleep(delay)\n\n```", "timestamp": 1639636020}}