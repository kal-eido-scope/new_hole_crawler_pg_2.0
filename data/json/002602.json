{"code": 0, "data": {"allow_search": true, "attention": false, "author_title": null, "blocked": false, "blocked_count": null, "can_del": false, "comments": [{"author_title": "", "blocked": false, "blocked_count": null, "can_del": false, "cid": 6107, "create_time": 1639636085, "is_blocked": false, "is_tmp": false, "name_id": 1, "text": "原来如此，还以为bot的作者也看耽美", "timestamp": 1639636085}, {"author_title": "", "blocked": false, "blocked_count": null, "can_del": false, "cid": 6109, "create_time": 1639636132, "is_blocked": false, "is_tmp": false, "name_id": 1, "text": "稚楚的名字写错了 看来也和bot作者无关", "timestamp": 1639636132}, {"author_title": "", "blocked": false, "blocked_count": null, "can_del": false, "cid": 6113, "create_time": 1639636331, "is_blocked": false, "is_tmp": false, "name_id": 1, "text": "我觉得频率可以低点，半个小时有点太频繁了哈哈哈", "timestamp": 1639636331}, {"author_title": "", "blocked": false, "blocked_count": null, "can_del": false, "cid": 6118, "create_time": 1639636514, "is_blocked": false, "is_tmp": false, "name_id": 2, "text": "好！", "timestamp": 1639636514}, {"author_title": "", "blocked": false, "blocked_count": null, "can_del": false, "cid": 6134, "create_time": 1639637161, "is_blocked": false, "is_tmp": false, "name_id": 2, "text": "小白再问个问题，这个代码复制下来后，我看到只要填入一个自己的token参数，然后本地运行就好了嘛，这个怎么运行一次就结束了诶，是得后台挂着一直运行嘛？", "timestamp": 1639637161}, {"author_title": "", "blocked": false, "blocked_count": null, "can_del": false, "cid": 6137, "create_time": 1639637336, "is_blocked": false, "is_tmp": false, "name_id": 0, "text": "Re Alice: 嘿，嘿嘿嘿", "timestamp": 1639637336}, {"author_title": "", "blocked": false, "blocked_count": null, "can_del": false, "cid": 6138, "create_time": 1639637443, "is_blocked": false, "is_tmp": false, "name_id": 0, "text": "Re Bob: token在命令行输入\n```\npython3 xxx.py token\n```\n直接结束是不是报错了，库没装全之类的", "timestamp": 1639637443}, {"author_title": "", "blocked": false, "blocked_count": null, "can_del": false, "cid": 6160, "create_time": 1639638424, "is_blocked": false, "is_tmp": false, "name_id": 2, "text": "Re 洞主: 嘿嘿成功啦，刚刚anaconda里面好像没有启动环境嘿嘿嘿", "timestamp": 1639638424}, {"author_title": "", "blocked": false, "blocked_count": null, "can_del": false, "cid": 6162, "create_time": 1639638433, "is_blocked": false, "is_tmp": false, "name_id": 2, "text": "Re 洞主: 谢谢dz！", "timestamp": 1639638433}, {"author_title": "", "blocked": false, "blocked_count": null, "can_del": false, "cid": 6214, "create_time": 1639640710, "is_blocked": false, "is_tmp": false, "name_id": 3, "text": "Re : 报时bot是怎么保持运行的呢，租了云服务器吗", "timestamp": 1639640710}, {"author_title": "", "blocked": false, "blocked_count": null, "can_del": false, "cid": 6229, "create_time": 1639642210, "is_blocked": false, "is_tmp": false, "name_id": 2, "text": "Re Carol: 就是在本地电脑一直开的呀，dz应该是设置了一个delay，定时运行（？", "timestamp": 1639642210}, {"author_title": "", "blocked": false, "blocked_count": null, "can_del": false, "cid": 6274, "create_time": 1639645774, "is_blocked": false, "is_tmp": false, "name_id": 3, "text": "Re Bob: 电脑都不关的吗😂", "timestamp": 1639645774}, {"author_title": "", "blocked": false, "blocked_count": null, "can_del": false, "cid": 8337, "create_time": 1639796376, "is_blocked": false, "is_tmp": false, "name_id": 4, "text": "Re Carol: 想多了，这类代码仍服务器里会给你自动执行，全程无需人工干预。还有 GitHub Actions 等自动化服务专门做这种事儿的", "timestamp": 1639796376}], "create_time": 1639636020, "cw": "报时bot代码", "hot_score": null, "is_blocked": false, "is_reported": null, "is_tmp": false, "last_comment_time": 1639796376, "likenum": 39, "n_attentions": 39, "n_comments": 13, "pid": 2602, "poll": null, "reply": 13, "text": "就是每到整点发一个post请求。\n吟诗用的是[一言](https://hitokoto.cn/)的接口。\n如有需要可随意取用。\n\n```python\nimport requests\nimport time\nfrom datetime import datetime\nimport sys\n\nclass Puppet:\n    def __init__(self, token):\n        self.token = token\n        self.api = r'https://hole.thu.monster/_api/v1/'\n        self.ua = r'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.93 Safari/537.36'\n\n    def post(self, content, *, cw='', allow_search=False):\n        payload = {\n            'cw': cw,\n            'text': content,\n            'allow_search': '1' if allow_search else '',\n            'type': 'text',\n        }\n        headers = {\n            'user-agent': self.ua,\n            'user-token': self.token,\n        }\n        url = self.api + 'dopost'\n        r = requests.post(url, data=payload, headers=headers)\n        print(r)\n\n\ndef getClock(now):\n    sentence_api = 'https://international.v1.hitokoto.cn/'\n    params = [\n        ['c', 'd'],\n        ['c', 'i'],\n        ['c', 'k'],\n    ] # 见https://developer.hitokoto.cn/sentence/#%E8%BF%94%E5%9B%9E%E6%A0%BC%E5%BC%8F\n    try:\n        r = requests.get(sentence_api, params=params)\n        data = r.json()\n    except Exception as e:\n        print(e)\n        data = None\n    if data:\n        hitokoto = data['hitokoto']\n        place = data['from']\n        author = data['from_who']\n        sentence = f'{hitokoto}\\n        ——{author}《{place}》'\n    else:\n        sentence = ''\n\n    now_str = now.strftime(r'%Y-%m-%d %H:%M')\n    content = f'#报时 **北京时间 {now_str}**\\n{sentence}'\n    return content\n\n\ndelay = 10\npuppet = Puppet(sys.argv[1])\n\nwhile True:\n    now = datetime.now()\n    # print(getClock(now))\n    print(now)\n    if now.minute == 0 or now.minute == 30:\n        content = getClock(now)\n        puppet.post(content, allow_search=True)\n        delay = 1800 - now.second\n    time.sleep(delay)\n\n```", "timestamp": 1639636020}}